<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENQU√äTE ANDR√âA - Mission Secr√®te</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Additional styles for new enigmas */
        .dossier-content {
            background: #1a1a1a;
            padding: 1.5rem;
            border: 1px solid #333;
            margin: 1rem 0;
        }

        .dossier-content p {
            margin: 0.5rem 0;
        }

        .dossier-link {
            color: #4da6ff;
            text-decoration: underline;
            cursor: pointer;
        }

        .dossier-link:hover {
            color: #80c0ff;
        }

        .folder-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: #111;
        }

        .folder {
            background: #222;
            border: 1px solid #444;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            font-family: monospace;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .folder:hover {
            background: #333;
            border-color: var(--color-accent);
        }

        .map-container {
            position: relative;
            max-width: 100%;
            margin: 1rem auto;
        }

        .map-container img {
            width: 100%;
            max-width: 500px;
            display: block;
            margin: 0 auto;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            pointer-events: none;
        }

        .grid-labels-x,
        .grid-labels-y {
            display: flex;
            justify-content: space-around;
            font-size: 0.8rem;
            color: #888;
        }

        .badge-ref {
            width: 60px;
            margin: 0.5rem auto;
            display: block;
        }

        .file-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-option {
            background: #222;
            border: 1px solid #444;
            padding: 10px;
            cursor: pointer;
            font-family: monospace;
        }

        .file-option:hover {
            background: #333;
            border-color: #4da6ff;
        }

        .message-bubble {
            background: linear-gradient(135deg, #1a5c1a, #0d3d0d);
            border-radius: 15px;
            padding: 1rem;
            margin: 1rem 0;
            position: relative;
        }

        .message-header {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 0.5rem;
        }

        .cipher-text {
            font-family: monospace;
            font-size: 1.1rem;
            letter-spacing: 2px;
            word-break: break-all;
        }

        .highlight-ln {
            color: #ff6b6b;
            font-weight: bold;
        }

        .hint-image {
            max-width: 300px;
            margin: 1rem auto;
            display: block;
            border: 2px solid #444;
        }

        .completed-check {
            color: #4CAF50;
            font-size: 1.5rem;
        }

        /* Full Dossier Styles */
        .dossier-full-content {
            background: linear-gradient(135deg, #1a1a1a, #0d0d0d);
            padding: 2rem;
            border: 2px solid #333;
            border-radius: 10px;
            max-height: 70vh;
            overflow-y: auto;
            margin: 1rem 0;
        }

        .dossier-header {
            text-align: center;
            border-bottom: 1px solid #444;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .dossier-section {
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid var(--color-accent);
        }

        .dossier-section h3 {
            color: var(--color-accent);
            margin-bottom: 0.5rem;
        }

        .dossier-section ul {
            list-style: disc;
            margin-left: 1.5rem;
        }

        .dossier-section li {
            margin: 0.5rem 0;
        }

        .dossier-signature {
            text-align: right;
            margin-top: 2rem;
            font-style: italic;
            color: #888;
        }

        /* Easter Egg styling */
        .easter-egg {
            position: relative;
        }

        .easter-egg::after {
            content: "üîç";
            font-size: 0.7rem;
            margin-left: 5px;
            opacity: 0.5;
        }

        /* Improved Grid Alignment for Enigma 3 */
        .map-grid-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 1rem 0;
        }

        .grid-row-x {
            display: flex;
            width: 100%;
            max-width: 450px;
            justify-content: space-around;
            padding-left: 25px;
            margin-bottom: 5px;
        }

        .grid-row-x span {
            width: 56px;
            text-align: center;
            font-weight: bold;
            color: var(--color-accent);
            font-size: 1rem;
        }

        .map-with-labels {
            display: flex;
            align-items: stretch;
        }

        .grid-col-y {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding-right: 5px;
            height: 450px;
        }

        .grid-col-y span {
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--color-accent);
            font-size: 1rem;
        }

        .map-image-wrapper {
            position: relative;
            width: 450px;
            height: 450px;
        }

        .map-image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>

<body>

    <div class="chrono-display" id="chrono">00:00</div>

    <div class="mission-container">
        <h1>üîç ENQU√äTE ANDR√âA</h1>

        <!-- STEP 0: INTRO -->
        <div id="step-intro" class="step-box active">
            <h2>Briefing Mission</h2>
            <p>Agent <span id="agent-name"></span>,</p>
            <p>Andrea a besoin de modifier son dossier. Nous devons nous introduire dans la salle des archives.</p>
            <p>5 √©nigmes vous attendent pour d√©couvrir le <strong>CODE SECRET</strong>.</p>
            <p><em>Chaque erreur ajoute une p√©nalit√© de temps !</em></p>
            <button class="btn-submit" id="btn-start-mission">üöÄ COMMENCER L'ENQU√äTE</button>
        </div>

        <!-- ENIGMA 1: COORDINATES -->
        <div id="step-enigma1" class="step-box">
            <h2>√ânigme 1/5 : Le Code de la Porte</h2>
            <p>Pour entrer dans la salle des dossiers, il faut le mot de passe.</p>
            <p>Indice : <em>"Suivre le soleil..."</em></p>
            <p>S√©quence g√©ographique d√©tect√©e :</p>

            <div id="coords-grid" class="coords-grid">
                <!-- JS will populate this -->
            </div>

            <div class="clue-box">
                <p>Entrez le mot de passe (9 lettres) :</p>
                <div class="code-input-group">
                    <input type="text" id="code-enigma1" maxlength="9" placeholder="_ _ _ _ _ _ _ _ _"
                        style="text-transform: uppercase;">
                    <button id="btn-enigma1" class="btn-submit">VALIDER</button>
                </div>
            </div>
        </div>

        <!-- ENIGMA 2: FOLDERS -->
        <div id="step-enigma2" class="step-box">
            <h2>√ânigme 2/5 : La Salle des Archives</h2>
            <p>Vous √™tes dans la salle. Il y a des milliers de dossiers.</p>
            <p>Nous cherchons le dossier d'Andrea.</p>
            <p><strong>La police range ses dossiers de cette fa√ßon : MM-AA-XX o√π XX sont des initiales.</strong></p>

            <div class="clue-box">
                <button id="btn-hint" class="btn-submit" style="background: #444; font-size: 0.9rem;">DEMANDER UN INDICE
                    (+30s)</button>
                <div id="hint-display" style="margin-top: 10px;"></div>
            </div>

            <p style="margin-top: 1rem;">Trouvez le bon dossier :</p>
            <div id="folder-grid" class="folder-grid">
                <!-- JS will populate -->
            </div>
        </div>

        <!-- ENIGMA 2B: DOSSIER VIEW (after finding folder) -->
        <div id="step-dossier" class="step-box">
            <h2>üìÅ Dossier 10-72-LP</h2>
            <p>Vous avez trouv√© le dossier ! √Ä l'int√©rieur, plusieurs pi√®ces :</p>

            <div class="dossier-content">
                <p>üìÑ <span class="dossier-link easter-egg" data-easter="rickroll">Papiers d'identit√©</span></p>
                <p>üìÑ <span class="dossier-link easter-egg" data-easter="belge">Certificat m√©dical</span></p>
                <p>üó∫Ô∏è <span class="dossier-link" data-target="step-enigma3">Carte de la planque (Enigme Carte)</span>
                    <span id="check-enigma3" class="completed-check" style="display:none;">‚úì</span>
                </p>
                <p>üìÑ <span class="dossier-link easter-egg" data-easter="matthias">Rapport d'enqu√™te</span></p>
                <p>üéß <span class="dossier-link" data-target="step-enigma4">Enregistrement audio (Enigme Audio)</span>
                    <span id="check-enigma4" class="completed-check" style="display:none;">‚úì</span>
                </p>
                <p>üìÑ <span class="dossier-link easter-egg" data-easter="jeu">Notes personnelles</span></p>
                <p>üìã <span class="dossier-link" data-target="step-dossier-full">Dossier d'inculpation complet</span>
                </p>
            </div>

            <p id="dossier-instruction">Examinez les √©l√©ments importants pour continuer...</p>
            <button id="btn-continue-final" class="btn-submit" style="display:none;">üîì ACC√âDER AU MESSAGE
                FINAL</button>
        </div>

        <!-- FULL DOSSIER VIEW -->
        <div id="step-dossier-full" class="step-box">
            <h2>üìã DOSSIER D'INCULPATION ‚Äì AFFAIRE 158</h2>

            <div class="dossier-full-content">
                <div class="dossier-header">
                    <p><strong>R√âPUBLIQUE FRAN√áAISE</strong></p>
                    <p>MINIST√àRE DE L'INT√âRIEUR</p>
                    <p>Direction de la Police Judiciaire</p>
                    <p style="margin-top: 1rem;"><strong>Dossier n¬∞ 10-72-LP</strong></p>
                </div>

                <div class="dossier-section">
                    <p><strong>Suspect :</strong> Andr√©a BORRON</p>
                    <p><strong>Chef d'inculpation :</strong> Cambriolage aggrav√© du b√¢timent dit ¬´ 158 ¬ª</p>
                </div>

                <div class="dossier-section">
                    <h3>R√©sum√© des faits :</h3>
                    <p>Le 12 Novembre 2025 √† 22h14, une intrusion non autoris√©e a √©t√© constat√©e dans le b√¢timent connu
                        sous l'appellation ¬´ 158 ¬ª, situ√© sur le Cours Fauriel √† Saint Etienne. Plusieurs objets de
                        valeur et dossiers confidentiels ont √©t√© signal√©s manquants.</p>
                    <p>Selon les premi√®res constatations, l'individu aurait forc√© une entr√©e secondaire √† l'aide d'une
                        carte de service. Des traces de pas, des empreintes partielles et une cam√©ra de surveillance
                        d√©sactiv√©e laissent penser √† une op√©ration pr√©m√©dit√©e.</p>
                </div>

                <div class="dossier-section">
                    <h3>Profil du suspect :</h3>
                    <p>Andr√©a Borron, 21 ans, ancien employ√© d'une soci√©t√© de maintenance travaillant r√©guli√®rement dans
                        le b√¢timent 158. Il disposait d'un badge d'acc√®s valide jusqu'en mars 2026.</p>
                </div>

                <div class="dossier-section">
                    <h3>T√©moignages :</h3>
                    <p>Trois t√©moins affirment avoir aper√ßu une silhouette correspondant au suspect aux abords du site
                        la nuit du cambriolage.</p>
                </div>

                <div class="dossier-section">
                    <h3>Preuves mat√©rielles :</h3>
                    <ul>
                        <li>Empreinte partielle retrouv√©e sur une porte m√©tallique / Enregistrements vid√©o <em>(Enigme
                                audio)</em></li>
                        <li>Badge d'acc√®s utilis√© hors horaires autoris√©s <em>(Enigme Carte)</em></li>
                    </ul>
                </div>

                <div class="dossier-section">
                    <h3>Analyse :</h3>
                    <p>Les √©l√©ments recueillis indiquent une connaissance approfondie des lieux et de leurs syst√®mes de
                        s√©curit√©. L'usage d'un badge valide sugg√®re une personne ayant un acc√®s l√©gitime ant√©rieur.</p>
                </div>

                <div class="dossier-section">
                    <h3>Conclusion provisoire :</h3>
                    <p>En l'√©tat des preuves, Andr√©a Borron est inculp√© pour cambriolage aggrav√©. L'enqu√™te reste en
                        cours afin de d√©terminer d'√©ventuelles complicit√©s et le mobile exact.</p>
                </div>

                <div class="dossier-signature">
                    <p><em>Rapport √©tabli par :</em></p>
                    <p><strong>Capitaine Mickael Pommier</strong></p>
                    <p>Police Judiciaire de Saint Etienne</p>
                </div>

                <hr style="margin: 2rem 0; border-color: #444;">

                <h2>üìã DOSSIER D'INCULPATION ‚Äì USURPATION D'IDENTIT√â</h2>

                <div class="dossier-header">
                    <p><strong>R√âPUBLIQUE FRAN√áAISE</strong></p>
                    <p>MINIST√àRE DE L'INT√âRIEUR</p>
                    <p>Direction de la Police Judiciaire</p>
                    <p style="margin-top: 1rem;"><strong>Dossier n¬∞ 10-72-LP</strong></p>
                </div>

                <div class="dossier-section">
                    <p><strong>Suspect :</strong> Andr√©a Borron</p>
                    <p><strong>Chef d'inculpation :</strong> Usurpation d'identit√©</p>
                </div>

                <div class="dossier-section">
                    <h3>R√©sum√© des faits :</h3>
                    <p>Andr√©a a √©t√© attrap√© alors qu'il se faisait passer pour un policier. Son arriv√©e dans le service
                        daterait du 1er Novembre 2025, depuis il aurait fourni les informations n√©cessaires √† ses
                        √©quipes afin de pr√©voir leur coup √† l'avance.</p>
                    <p>Celui-ci se ferait passer pour un certain <strong>Andr√©a Boiron</strong>.</p>
                </div>

                <div class="dossier-section">
                    <h3>Profil du suspect :</h3>
                    <p>Andr√©a Borron, 21 ans</p>
                </div>

                <div class="dossier-signature">
                    <p><em>Rapport √©tabli par :</em></p>
                    <p><strong>Capitaine √âlodie Renaud</strong></p>
                    <p>Police Judiciaire de Montreval</p>
                </div>
            </div>

            <button class="btn-submit" onclick="nextStep('step-dossier')">‚¨ÖÔ∏è RETOUR AU DOSSIER</button>
        </div>

        <!-- ENIGMA 3: MAP (Where's Waldo) -->
        <div id="step-enigma3" class="step-box">
            <h2>√ânigme 3/5 : La Carte de la Planque</h2>
            <p>Cette carte montre l'int√©rieur d'une pi√®ce. Un <strong>badge d'identification</strong> est cach√© quelque
                part.</p>
            <p>Trouvez ses coordonn√©es sur la grille (lettre + chiffre).</p>

            <p style="text-align:center; color:#888;">Ce que vous cherchez :</p>
            <img src="badge_id.png" alt="Badge ID" class="badge-ref">

            <div class="map-grid-container">
                <!-- Lettres en haut (A-H) -->
                <div class="grid-row-x">
                    <span>A</span><span>B</span><span>C</span><span>D</span><span>E</span><span>F</span><span>G</span><span>H</span>
                </div>

                <div class="map-with-labels">
                    <!-- Chiffres √† gauche (1-8) -->
                    <div class="grid-col-y">
                        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span>
                    </div>

                    <!-- Image de la carte -->
                    <div class="map-image-wrapper">
                        <img src="carte_enigme.jpg" alt="Carte de la planque">
                    </div>
                </div>
            </div>

            <div class="clue-box">
                <p>Coordonn√©es du badge (ex: C4) :</p>
                <div class="code-input-group">
                    <input type="text" id="code-enigma3" maxlength="2" placeholder="_ _"
                        style="text-transform: uppercase;">
                    <button id="btn-enigma3" class="btn-submit">SCANNER</button>
                </div>
            </div>
        </div>

        <!-- ENIGMA 4: AUDIO -->
        <div id="step-enigma4" class="step-box">
            <h2>√ânigme 4/5 : L'Enregistrement</h2>
            <p>"J'ai chop√© une discussion entre officiers. Y'a quelques interf√©rences mais tu dois pouvoir entendre le
                nom du dossier."</p>

            <div class="audio-player-box"
                style="text-align:center; padding:1.5rem; background:#111; margin:1rem 0; border-radius:10px;">
                <p style="color:#888;">[ üéß AUDIO: Discussion + Interf√©rences ]</p>
                <audio id="audio-morse" controls style="width:100%; max-width:400px; margin: 1rem 0;">
                    <source src="audio_morse.mp3" type="audio/mpeg">
                    Votre navigateur ne supporte pas l'audio.
                </audio>
                <p style="font-size:0.8rem; color:#666; margin-top:0.5rem;">√âcoutez attentivement le code morse...</p>
            </div>

            <p>Quel nom de dossier avez-vous entendu ?</p>
            <div class="file-list" id="file-list">
                <!-- JS will populate -->
            </div>
        </div>

        <!-- ENIGMA 5: FINAL CIPHER -->
        <div id="step-enigma5" class="step-box">
            <h2>√ânigme Finale : Le Message d'H√©l√®ne</h2>
            <p>Vous recevez un message crypt√©...</p>

            <div class="message-bubble">
                <div class="message-header">üì± Message de H√©<span class="highlight-ln">l</span>√®<span
                        class="highlight-ln">n</span>e</div>
                <p style="margin-bottom: 1rem;">Je ne peux pas te donner la ville dans laquelle il a mis son tr√©sor,
                    tout ce que j'ai comme info c'est ce message bizarre :</p>
                <p class="cipher-text">"ITCEG C TGIKU, NC EJQWGVVG A GUV F'QT"</p>
                <p style="margin-top: 1rem; font-style: italic; color: #888;">(Bonne chance)</p>
            </div>

            <div class="clue-box">
                <p>Quelle est la ville du tr√©sor ? (4 lettres)</p>
                <div class="code-input-group">
                    <input type="text" id="code-final" maxlength="4" placeholder="_ _ _ _"
                        style="text-transform: uppercase;">
                    <button id="btn-final" class="btn-submit">TERMINER LA MISSION</button>
                </div>
            </div>
        </div>

        <!-- SUCCESS -->
        <div id="step-success" class="step-box">
            <h2 style="color:#4CAF50;">üéâ MISSION ACCOMPLIE !</h2>
            <p>Bravo Agent ! Vous avez d√©cod√© le message.</p>
            <p>Le tr√©sor est √† <strong style="color: var(--color-accent);">DABO</strong>.</p>
            <p style="font-size:0.9rem; color:#888;">"Gr√¢ce √† R√©gis, la chouette y est d'or"</p>

            <div style="text-align:center; margin-top:2rem;">
                <p style="font-size:2rem;">Temps Final : <span id="final-time-display"
                        style="color:var(--color-accent);"></span></p>
            </div>

            <button class="btn-submit" onclick="location.href='../../index.html'">RETOURNER AU QG</button>
        </div>

    </div>

    <script src="data.js"></script>
    <script src="day1.js"></script>
</body>

</html>