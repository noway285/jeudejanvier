// Firestore Security Rules for Docteur Maboul
// Deploy these rules in Firebase Console > Firestore > Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Scores collection
    match /scores/{scoreId} {
      
      // Anyone can read scores (for leaderboard)
      allow read: if true;
      
      // Anyone can create a new score
      // Validation:
      // - name must be a string, max 20 characters
      // - time must be a positive number (milliseconds)
      // - createdAt should be a server timestamp
      allow create: if 
        request.resource.data.name is string &&
        request.resource.data.name.size() <= 20 &&
        request.resource.data.name.size() >= 1 &&
        request.resource.data.time is number &&
        request.resource.data.time > 0 &&
        request.resource.data.time < 600000; // Max 10 minutes (anti-cheat)
      
      // No updates allowed (scores are immutable)
      allow update: if false;
      
      // No deletes allowed (only admin via console)
      allow delete: if false;
    }
    
    // Deny access to all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

/*
 * SETUP INSTRUCTIONS:
 * 
 * 1. Go to https://console.firebase.google.com
 * 2. Create a new project (or use existing)
 * 3. Enable Firestore Database:
 *    - Click "Build" > "Firestore Database"
 *    - Click "Create database"
 *    - Start in "production mode"
 *    - Select a region close to your users
 * 
 * 4. Add these security rules:
 *    - Go to "Rules" tab in Firestore
 *    - Copy the rules above (without this comment block)
 *    - Click "Publish"
 * 
 * 5. Create indexes (optional, for better performance):
 *    - Go to "Indexes" tab
 *    - Create a composite index:
 *      Collection: scores
 *      Field: time (Ascending)
 *      Query scope: Collection
 * 
 * 6. Get your Firebase config:
 *    - Go to Project Settings (gear icon)
 *    - Scroll to "Your apps" > Web app
 *    - If no web app, click "Add app" > Web
 *    - Copy the firebaseConfig object
 *    - Paste it in index.html replacing the placeholder
 * 
 * 7. (Optional) Enable Firebase Hosting:
 *    - npm install -g firebase-tools
 *    - firebase login
 *    - firebase init hosting
 *    - firebase deploy
 */
